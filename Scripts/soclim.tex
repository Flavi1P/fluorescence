% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{lmodern}
\usepackage{amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
  \usepackage{amssymb}
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={soclim.R},
  pdfauthor={flavien},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi

\title{soclim.R}
\author{flavien}
\date{2021-04-26}

\begin{document}
\maketitle

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- Attaching packages -------------------------------------------------------- tidyverse 1.3.0 --
\end{verbatim}

\begin{verbatim}
## v ggplot2 3.3.2     v purrr   0.3.4
## v tibble  3.0.3     v dplyr   1.0.2
## v tidyr   1.1.2     v stringr 1.4.0
## v readr   1.3.1     v forcats 0.4.0
\end{verbatim}

\begin{verbatim}
## -- Conflicts ----------------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ncdf4)}
\FunctionTok{library}\NormalTok{(readxl)}
\FunctionTok{library}\NormalTok{(sf)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Linking to GEOS 3.5.1, GDAL 2.2.2, PROJ 4.9.2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(oce)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: testthat
\end{verbatim}

\begin{verbatim}
## Error in get(genname, envir = envir) : objet 'testthat_print' introuvable
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'testthat'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:dplyr':
## 
##     matches
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:purrr':
## 
##     is_null
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:tidyr':
## 
##     matches
\end{verbatim}

\begin{verbatim}
## Loading required package: gsw
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(metR)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'metR'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:oce':
## 
##     coriolis
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:purrr':
## 
##     cross
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(vegan)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: permute
\end{verbatim}

\begin{verbatim}
## Loading required package: lattice
\end{verbatim}

\begin{verbatim}
## This is vegan 2.5-6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# soclim \textless{}{-} read\_delim("Data/soclim/soclim\_btl\_V9.txt", }
\CommentTok{\#            "\textbackslash{}t", escape\_double = FALSE, trim\_ws = TRUE)}
\CommentTok{\# soclim \textless{}{-} janitor::clean\_names(soclim[, c(1:103)])}


\NormalTok{soclim }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"Data/soclim/soclim\_abs.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   .default = col_double(),
##   cruise = col_character(),
##   station = col_character(),
##   type = col_character(),
##   time = col_datetime(format = ""),
##   chlorophyll_c3 = col_character(),
##   chlorophyll_c1_c2_mg_dvp = col_character(),
##   sum_chlorophyllide_a = col_character(),
##   peridinin = col_character(),
##   sum_phaeophorbid_a = col_character(),
##   x19_butanoyloxyfucoxanthin = col_character(),
##   fucoxanthin = col_character(),
##   neoxanthin = col_character(),
##   prasinoxanthin = col_character(),
##   violaxanthin = col_character(),
##   x19_hexanoyloxyfucoxanthin = col_character(),
##   diadinoxanthin = col_character(),
##   alloxanthin = col_character(),
##   diatoxanthin = col_character(),
##   zeaxanthin = col_character(),
##   lutein = col_character()
##   # ... with 9 more columns
## )
\end{verbatim}

\begin{verbatim}
## See spec(...) for full column specifications.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soclim }\OtherTok{\textless{}{-}}\NormalTok{ soclim }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{cast\_id =} \FunctionTok{paste}\NormalTok{(station, ctd\_number))}

\NormalTok{soclim}\SpecialCharTok{$}\NormalTok{total\_chlorophyll\_a }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(soclim}\SpecialCharTok{$}\NormalTok{total\_chlorophyll\_a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: NAs introduits lors de la conversion automatique
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(soclim)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ fluorescence\_eco\_rfu, }\AttributeTok{y =} \SpecialCharTok{{-}}\NormalTok{ depth\_m, }\AttributeTok{group =}\NormalTok{ cast\_id))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ fluorescence\_wetlabs\_rfu, }\AttributeTok{y =} \SpecialCharTok{{-}}\NormalTok{ depth\_m), }\AttributeTok{colour =} \StringTok{"Brown"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ total\_chlorophyll\_a, }\AttributeTok{y =} \SpecialCharTok{{-}}\NormalTok{depth\_m), }\AttributeTok{colour =} \StringTok{"Green"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{400}\NormalTok{,}\DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(.}\SpecialCharTok{\textasciitilde{}}\NormalTok{cast\_id)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 131 rows containing missing values (geom_point).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 114 rows containing missing values (geom_point).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 234 rows containing missing values (geom_point).
\end{verbatim}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(soclim)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ longitude\_deg\_east, }\AttributeTok{y =}\NormalTok{ latitude\_deg\_north, }\AttributeTok{colour =}\NormalTok{ station))}
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soclim\_ratio }\OtherTok{\textless{}{-}}\NormalTok{ soclim }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{na.omit}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{relativ\_chl =}\NormalTok{ total\_chlorophyll\_a}\SpecialCharTok{/}\FunctionTok{max}\NormalTok{(total\_chlorophyll\_a),}
                                  \AttributeTok{ratio =}\NormalTok{ fluorescence\_eco\_rfu}\SpecialCharTok{*}\FloatTok{2.5}\SpecialCharTok{/}\NormalTok{total\_chlorophyll\_a,}
                                  \AttributeTok{relativ\_ratio =}\NormalTok{ fluorescence\_eco\_rfu}\SpecialCharTok{/}\NormalTok{relativ\_chl,}
         \AttributeTok{yield =}\NormalTok{ fluorescence\_eco\_rfu}\SpecialCharTok{/}\NormalTok{pur470) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(depth\_m }\SpecialCharTok{\textless{}} \DecValTok{100}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(cast\_id) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(cast\_id, }\StringTok{"lon"} \OtherTok{=}\NormalTok{ longitude\_deg\_east, }\StringTok{"lat"} \OtherTok{=}\NormalTok{ latitude\_deg\_north, relativ\_chl, ratio, relativ\_ratio, total\_chlorophyll\_a, fluorescence\_eco\_rfu, yield) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise\_all}\NormalTok{(mean, }\AttributeTok{na.omit =} \ConstantTok{TRUE}\NormalTok{)}

\NormalTok{worldmap }\OtherTok{\textless{}{-}} \FunctionTok{map\_data}\NormalTok{(}\StringTok{"world"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(long }\SpecialCharTok{\textgreater{}} \FunctionTok{min}\NormalTok{(soclim\_ratio}\SpecialCharTok{$}\NormalTok{lon) }\SpecialCharTok{\&}\NormalTok{ long }\SpecialCharTok{\textless{}} \FunctionTok{max}\NormalTok{(soclim\_ratio}\SpecialCharTok{$}\NormalTok{lon) }\SpecialCharTok{\&}\NormalTok{ lat }\SpecialCharTok{\textless{}} \FunctionTok{max}\NormalTok{(soclim\_ratio}\SpecialCharTok{$}\NormalTok{lat) }\SpecialCharTok{\&}\NormalTok{ lat }\SpecialCharTok{\textgreater{}} \FunctionTok{min}\NormalTok{(soclim\_ratio}\SpecialCharTok{$}\NormalTok{lat))}

\FunctionTok{ggplot}\NormalTok{(soclim\_ratio)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ lon, }\AttributeTok{y =}\NormalTok{ lat, }\AttributeTok{colour =}\NormalTok{ ratio), }\AttributeTok{size =} \DecValTok{4}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_polygon}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ long, }\AttributeTok{y =}\NormalTok{ lat), }\AttributeTok{data =}\NormalTok{ worldmap)}\SpecialCharTok{+}
  \FunctionTok{scale\_colour\_distiller}\NormalTok{(}\AttributeTok{palette =} \StringTok{"RdBu"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{coord\_quickmap}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soclim\_plot }\OtherTok{\textless{}{-}}\NormalTok{ soclim }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{na.omit}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{relativ\_chl =}\NormalTok{ total\_chlorophyll\_a}\SpecialCharTok{/}\FunctionTok{max}\NormalTok{(total\_chlorophyll\_a),}
         \AttributeTok{ratio =}\NormalTok{ fluorescence\_eco\_rfu}\SpecialCharTok{*}\FloatTok{2.5}\SpecialCharTok{/}\NormalTok{total\_chlorophyll\_a,}
         \AttributeTok{relativ\_ratio =}\NormalTok{ fluorescence\_eco\_rfu}\SpecialCharTok{/}\NormalTok{relativ\_chl) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(depth\_m }\SpecialCharTok{\textless{}} \DecValTok{100}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{group =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    ratio }\SpecialCharTok{\textless{}} \FloatTok{1.9} \SpecialCharTok{\textasciitilde{}} \StringTok{"low"}\NormalTok{,}
\NormalTok{    ratio }\SpecialCharTok{\textgreater{}=} \FloatTok{1.9} \SpecialCharTok{\textasciitilde{}} \StringTok{"high"}\NormalTok{))}

\FunctionTok{ggplot}\NormalTok{(soclim\_plot)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ total\_chlorophyll\_a, }\AttributeTok{y =}\NormalTok{ fluorescence\_eco\_rfu, }\AttributeTok{colour =}\NormalTok{ group))}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(soclim\_plot)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ longitude\_deg\_east, }\AttributeTok{y =}\NormalTok{ latitude\_deg\_north, }\AttributeTok{colour =}\NormalTok{ group), }\AttributeTok{size =} \DecValTok{4}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_polygon}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ long, }\AttributeTok{y =}\NormalTok{ lat), }\AttributeTok{data =}\NormalTok{ worldmap)}\SpecialCharTok{+}
  \FunctionTok{coord\_quickmap}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-5.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(soclim\_plot)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =} \SpecialCharTok{{-}}\NormalTok{depth\_m, }\AttributeTok{x =}\NormalTok{ latitude\_deg\_north, }\AttributeTok{colour =}\NormalTok{ group), }\AttributeTok{size =} \DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-6.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soclim\_dist }\OtherTok{\textless{}{-}}\NormalTok{ soclim }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(fluorescence\_eco\_rfu }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{log\_chla =} \FunctionTok{log}\NormalTok{(total\_chlorophyll\_a),}
                            \AttributeTok{log\_eco =} \FunctionTok{log}\NormalTok{(fluorescence\_eco\_rfu),}
         \AttributeTok{yield =}\NormalTok{ fluorescence\_eco\_rfu}\SpecialCharTok{/}\NormalTok{pur470)}
\FunctionTok{ggplot}\NormalTok{(soclim\_dist)}\SpecialCharTok{+}
  \FunctionTok{geom\_density}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ log\_chla), }\AttributeTok{colour =} \StringTok{"Brown"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_density}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ log\_eco), }\AttributeTok{colour =} \StringTok{"Grey"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 151 rows containing non-finite values (stat_density).
\end{verbatim}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-7.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(soclim\_dist)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ fluorescence\_eco\_rfu, }\AttributeTok{y =} \SpecialCharTok{{-}}\NormalTok{ depth\_m, }\AttributeTok{group =}\NormalTok{ cast\_id))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ fluorescence\_eco\_rfu, }\AttributeTok{y =} \SpecialCharTok{{-}}\NormalTok{depth\_m), }\AttributeTok{data =} \FunctionTok{filter}\NormalTok{(soclim\_dist, log\_eco }\SpecialCharTok{\textless{}} \SpecialCharTok{{-}}\DecValTok{4}\NormalTok{), }\AttributeTok{colour =} \StringTok{"Red"}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ total\_chlorophyll\_a, }\AttributeTok{y =} \SpecialCharTok{{-}}\NormalTok{depth\_m), }\AttributeTok{colour =} \StringTok{"Green"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{400}\NormalTok{,}\DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(.}\SpecialCharTok{\textasciitilde{}}\NormalTok{cast\_id)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 53 rows containing missing values (geom_point).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 53 rows containing missing values (geom_point).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 160 rows containing missing values (geom_point).
\end{verbatim}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-8.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soclim\_dist\_clean }\OtherTok{\textless{}{-}}\NormalTok{ soclim\_dist }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(log\_eco }\SpecialCharTok{\textgreater{}} \SpecialCharTok{{-}}\DecValTok{4}\NormalTok{)}

\FunctionTok{ggplot}\NormalTok{(soclim\_dist\_clean)}\SpecialCharTok{+}
  \FunctionTok{geom\_density}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ log\_chla), }\AttributeTok{colour =} \StringTok{"Brown"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_density}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ log\_eco), }\AttributeTok{colour =} \StringTok{"Grey"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 77 rows containing non-finite values (stat_density).
\end{verbatim}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-9.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(soclim\_dist\_clean)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{log\_chla, }\AttributeTok{y =}\NormalTok{ log\_eco, }\AttributeTok{colour =}\NormalTok{ station))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 77 rows containing missing values (geom_point).
\end{verbatim}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-10.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(soclim\_dist\_clean)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ total\_chlorophyll\_a, }\AttributeTok{y =}\NormalTok{ fluorescence\_eco\_rfu, }\AttributeTok{colour =}\NormalTok{ station))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 77 rows containing missing values (geom_point).
\end{verbatim}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-11.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soclim\_dist\_clean }\OtherTok{\textless{}{-}}\NormalTok{ soclim\_dist\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{na.omit}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{relativ\_chl =}\NormalTok{ total\_chlorophyll\_a}\SpecialCharTok{/}\FunctionTok{max}\NormalTok{(total\_chlorophyll\_a),}
         \AttributeTok{ratio =}\NormalTok{ fluorescence\_eco\_rfu}\SpecialCharTok{*}\FloatTok{2.5}\SpecialCharTok{/}\NormalTok{total\_chlorophyll\_a,}
         \AttributeTok{relativ\_ratio =}\NormalTok{ fluorescence\_eco\_rfu}\SpecialCharTok{/}\NormalTok{relativ\_chl,}
         \AttributeTok{eco\_test =}\NormalTok{ fluorescence\_eco\_rfu }\SpecialCharTok{*} \FunctionTok{max}\NormalTok{(total\_chlorophyll\_a)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{group =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    ratio }\SpecialCharTok{\textless{}} \FloatTok{1.9} \SpecialCharTok{\textasciitilde{}} \StringTok{"low"}\NormalTok{,}
\NormalTok{    ratio }\SpecialCharTok{\textgreater{}=} \FloatTok{1.9} \SpecialCharTok{\textasciitilde{}} \StringTok{"high"}\NormalTok{))}

\FunctionTok{ggplot}\NormalTok{(soclim\_dist\_clean)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ total\_chlorophyll\_a, }\AttributeTok{y =}\NormalTok{ fluorescence\_eco\_rfu, }\AttributeTok{colour =}\NormalTok{ group))}
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-12.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\FunctionTok{filter}\NormalTok{(soclim\_dist\_clean, group }\SpecialCharTok{==} \StringTok{"high"}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ eco\_test, }\AttributeTok{y =} \SpecialCharTok{{-}}\NormalTok{ depth\_m, }\AttributeTok{group =}\NormalTok{ cast\_id))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ total\_chlorophyll\_a, }\AttributeTok{y =} \SpecialCharTok{{-}}\NormalTok{depth\_m), }\AttributeTok{colour =} \StringTok{"Green"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{200}\NormalTok{,}\DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(.}\SpecialCharTok{\textasciitilde{}}\NormalTok{cast\_id)}
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-13.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(soclim\_dist\_clean)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ eco\_test, }\AttributeTok{y =} \SpecialCharTok{{-}}\NormalTok{ depth\_m, }\AttributeTok{colour =}\NormalTok{ group))}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ total\_chlorophyll\_a, }\AttributeTok{y =} \SpecialCharTok{{-}}\NormalTok{depth\_m), }\AttributeTok{colour =} \StringTok{"Green"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{200}\NormalTok{,}\DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(.}\SpecialCharTok{\textasciitilde{}}\NormalTok{cast\_id, }\AttributeTok{scales =} \StringTok{\textquotesingle{}free\_x\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 2 rows containing missing values (geom_point).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 2 rows containing missing values (geom_point).
\end{verbatim}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-14.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(soclim\_dist\_clean)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ yield, }\AttributeTok{y =}  \SpecialCharTok{{-}}\NormalTok{depth\_m, }\AttributeTok{colour =}\NormalTok{ group))}\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{200}\NormalTok{,}\DecValTok{0}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(.}\SpecialCharTok{\textasciitilde{}}\NormalTok{cast\_id)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 2 rows containing missing values (geom_point).
\end{verbatim}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-15.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(soclim\_dist\_clean)}\SpecialCharTok{+}
  \FunctionTok{geom\_violin}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ group, }\AttributeTok{y =}\NormalTok{ yield))}\SpecialCharTok{+}
  \FunctionTok{geom\_jitter}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ group, }\AttributeTok{y =}\NormalTok{ yield))}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-16.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(soclim\_dist\_clean)}\SpecialCharTok{+}
  \FunctionTok{geom\_violin}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ group, }\AttributeTok{y =}\NormalTok{ ratio))}\SpecialCharTok{+}
  \FunctionTok{geom\_jitter}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ group, }\AttributeTok{y =}\NormalTok{ ratio))}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-17.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nc\_path }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Data/soclim/current.nc"}\NormalTok{)}

\CommentTok{\# ncdf current {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}


\NormalTok{nc }\OtherTok{\textless{}{-}} \FunctionTok{nc\_open}\NormalTok{(nc\_path)}

\NormalTok{north\_mat }\OtherTok{\textless{}{-}} \FunctionTok{ncvar\_get}\NormalTok{(nc, }\StringTok{"vo"}\NormalTok{)}
\NormalTok{east\_mat }\OtherTok{\textless{}{-}} \FunctionTok{ncvar\_get}\NormalTok{(nc, }\StringTok{"uo"}\NormalTok{)}
\NormalTok{longitude }\OtherTok{\textless{}{-}} \FunctionTok{ncvar\_get}\NormalTok{(nc, }\StringTok{"longitude"}\NormalTok{)}
\NormalTok{latitude }\OtherTok{\textless{}{-}} \FunctionTok{ncvar\_get}\NormalTok{(nc, }\StringTok{"latitude"}\NormalTok{)}

\NormalTok{north\_df }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(north\_mat)}
\FunctionTok{names}\NormalTok{(north\_df) }\OtherTok{\textless{}{-}}\NormalTok{ latitude}

\NormalTok{east\_df }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(east\_mat)}
\FunctionTok{names}\NormalTok{(east\_df) }\OtherTok{\textless{}{-}}\NormalTok{ latitude}

\NormalTok{north\_df }\OtherTok{\textless{}{-}}\NormalTok{ north\_df }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\StringTok{"lon"}\OtherTok{=}\NormalTok{  longitude) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_longer}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{601}\NormalTok{), }\AttributeTok{names\_to =} \StringTok{"lat"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"north"}\NormalTok{)}

\NormalTok{east\_df }\OtherTok{\textless{}{-}}\NormalTok{ east\_df }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\StringTok{"lon"} \OtherTok{=}\NormalTok{ longitude) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_longer}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{601}\NormalTok{), }\AttributeTok{names\_to =} \StringTok{"lat"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"east"}\NormalTok{)}

\NormalTok{current\_df }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(north\_df, east\_df) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{vel =} \FunctionTok{sqrt}\NormalTok{(north}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{+}\NormalTok{east}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{),}
         \AttributeTok{lat =} \FunctionTok{as.numeric}\NormalTok{(lat))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Joining, by = c("lon", "lat")
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{subset\_df }\OtherTok{\textless{}{-}}\NormalTok{ current\_df }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(lon }\SpecialCharTok{\textgreater{}} \DecValTok{50} \SpecialCharTok{\&}\NormalTok{ lon }\SpecialCharTok{\textless{}} \DecValTok{80} \SpecialCharTok{\&}\NormalTok{ lat }\SpecialCharTok{\textless{}} \SpecialCharTok{{-}}\DecValTok{25} \SpecialCharTok{\&}\NormalTok{ lat }\SpecialCharTok{\textgreater{}} \SpecialCharTok{{-}}\DecValTok{60}\NormalTok{)}

\CommentTok{\# resume data {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}



\NormalTok{mean\_df }\OtherTok{\textless{}{-}}\NormalTok{ subset\_df }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lon\_ron =} \FunctionTok{round}\NormalTok{(lon),}
                                \AttributeTok{lat\_ron =} \FunctionTok{round}\NormalTok{(lat)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(lon\_ron, lat\_ron) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise\_all}\NormalTok{(mean)}

\CommentTok{\# heavy plot of current {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}


\CommentTok{\# ggplot(mean\_df)+}
\CommentTok{\#   geom\_raster(data = subset\_df, aes(x = lon, y = lat, fill = vel), interpolate = TRUE)+}
\CommentTok{\#   geom\_segment(aes(x = lon, xend = lon + east/1.2, y = lat, yend = lat+north/1.2), }
\CommentTok{\#                arrow = arrow(angle = 20, length = unit(.2, "cm"), type = "open"))+}
\CommentTok{\#   geom\_polygon(aes(x = long, y = lat), data = worldmap, fill = "Brown")+}
\CommentTok{\#   scale\_fill\_gradientn(name = "Speed\textbackslash{}n(m/s)",colours = oce::oceColorsVelocity(120), }
  \CommentTok{\#                      limits = c(0,1.6), breaks =seq(0.1,1.6,.3))+}
  \CommentTok{\# geom\_point(aes(x = longitude\_deg\_east, y = latitude\_deg\_north, colour = group), data =soclim\_dist\_clean)+}
  \CommentTok{\# theme\_bw()+}
  \CommentTok{\# theme(legend.position = "right",}
  \CommentTok{\#       legend.key.height = unit(1.4, "cm"), }
  \CommentTok{\#       legend.background = element\_blank(),}
  \CommentTok{\#       axis.text = element\_text(size = 12, colour = 1))+}
  \CommentTok{\# labs(x = "", y = "")+}
  \CommentTok{\# ggtitle("Current velocity near KI in October 2016")+}
  \CommentTok{\# coord\_quickmap()}

\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{  metR}\SpecialCharTok{::}\FunctionTok{geom\_contour\_fill}\NormalTok{(}\AttributeTok{data =}\NormalTok{ subset\_df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ lon, }\AttributeTok{y =}\NormalTok{ lat, }\AttributeTok{z =}\NormalTok{ vel), }\AttributeTok{na.fill =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{bins =} \DecValTok{70}\NormalTok{) }\SpecialCharTok{+} 
\NormalTok{  metR}\SpecialCharTok{::}\FunctionTok{geom\_vector}\NormalTok{(}\AttributeTok{data =}\NormalTok{ mean\_df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ lon, }\AttributeTok{y =}\NormalTok{ lat, }\AttributeTok{dx =}\NormalTok{ east, }\AttributeTok{dy =}\NormalTok{ north), }
                    \AttributeTok{arrow.angle =} \DecValTok{30}\NormalTok{, }\AttributeTok{arrow.type =} \StringTok{"open"}\NormalTok{, }\AttributeTok{arrow.length =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }
                    \AttributeTok{pivot =} \DecValTok{0}\NormalTok{,}\AttributeTok{preserve.dir =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{direction =} \StringTok{"ccw"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_polygon}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ long, }\AttributeTok{y =}\NormalTok{ lat), }\AttributeTok{data =}\NormalTok{ worldmap, }\AttributeTok{fill =} \StringTok{"Grey"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ longitude\_deg\_east, }\AttributeTok{y =}\NormalTok{ latitude\_deg\_north, }\AttributeTok{colour =}\NormalTok{ group), }\AttributeTok{data =}\NormalTok{soclim\_dist\_clean)}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_gradientn}\NormalTok{(}\AttributeTok{name =} \StringTok{"Speed}\SpecialCharTok{\textbackslash{}n}\StringTok{(m/s)"}\NormalTok{,}\AttributeTok{colours =} \FunctionTok{oceColorsVelocity}\NormalTok{(}\DecValTok{120}\NormalTok{), }
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{1.5}\NormalTok{), }\AttributeTok{breaks =}\FunctionTok{seq}\NormalTok{(}\FloatTok{0.1}\NormalTok{,}\FloatTok{1.6}\NormalTok{,.}\DecValTok{3}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"right"}\NormalTok{,}
        \AttributeTok{legend.key.height =} \FunctionTok{unit}\NormalTok{(}\FloatTok{1.2}\NormalTok{, }\StringTok{"cm"}\NormalTok{), }
        \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{(),}
        \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{12}\NormalTok{, }\AttributeTok{colour =} \DecValTok{1}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_mag}\NormalTok{(}\AttributeTok{max =} \DecValTok{1}\NormalTok{, }\AttributeTok{name =} \StringTok{"Speed"}\NormalTok{, }\AttributeTok{max\_size =} \FloatTok{0.5}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{scale\_colour\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Dark2"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{, }\AttributeTok{y =} \StringTok{""}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{coord\_quickmap}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: imputing missing values
\end{verbatim}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-18.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ncdf bathy {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}

\NormalTok{nc\_bath }\OtherTok{\textless{}{-}} \StringTok{"Data/GEBCO\_2014\_6x6min\_Global.nc"}

\NormalTok{bathy }\OtherTok{\textless{}{-}} \FunctionTok{nc\_open}\NormalTok{(nc\_bath)}
\NormalTok{lon }\OtherTok{\textless{}{-}} \FunctionTok{ncvar\_get}\NormalTok{(bathy, }\StringTok{"lon"}\NormalTok{)}
\NormalTok{lat }\OtherTok{\textless{}{-}} \FunctionTok{ncvar\_get}\NormalTok{(bathy, }\StringTok{"lat"}\NormalTok{)}
\NormalTok{height }\OtherTok{\textless{}{-}} \FunctionTok{ncvar\_get}\NormalTok{(bathy, }\StringTok{"Height"}\NormalTok{)}

\NormalTok{bath\_df }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(height)}
\FunctionTok{names}\NormalTok{(bath\_df) }\OtherTok{\textless{}{-}}\NormalTok{ lat}

\NormalTok{bath\_df }\OtherTok{\textless{}{-}}\NormalTok{ bath\_df }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\StringTok{"lon"} \OtherTok{=}\NormalTok{ lon) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_longer}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{1800}\NormalTok{), }\AttributeTok{names\_to =} \StringTok{"lat"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"height"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lat =} \FunctionTok{as.numeric}\NormalTok{(lat)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(lon }\SpecialCharTok{\textgreater{}} \DecValTok{50} \SpecialCharTok{\&}\NormalTok{ lon }\SpecialCharTok{\textless{}} \DecValTok{80} \SpecialCharTok{\&}\NormalTok{ lat }\SpecialCharTok{\textless{}} \SpecialCharTok{{-}}\DecValTok{25} \SpecialCharTok{\&}\NormalTok{ lat }\SpecialCharTok{\textgreater{}} \SpecialCharTok{{-}}\DecValTok{60}\NormalTok{)}

\CommentTok{\# plot of bathy {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}

\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_tile}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ lon, }\AttributeTok{y =}\NormalTok{ lat, }\AttributeTok{fill =}\NormalTok{ height), }\AttributeTok{data =}\NormalTok{ bath\_df)}\SpecialCharTok{+}
  \FunctionTok{geom\_polygon}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ long, }\AttributeTok{y =}\NormalTok{ lat), }\AttributeTok{data =}\NormalTok{ worldmap, }\AttributeTok{fill =} \StringTok{"Grey"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ longitude\_deg\_east, }\AttributeTok{y =}\NormalTok{ latitude\_deg\_north, }\AttributeTok{colour =}\NormalTok{ group), }\AttributeTok{data =}\NormalTok{soclim\_dist\_clean)}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_gradientn}\NormalTok{(}\AttributeTok{name =} \StringTok{"Bathymetri"}\NormalTok{,}\AttributeTok{colours =} \FunctionTok{oceColorsGebco}\NormalTok{(),}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{6000}\NormalTok{,}\DecValTok{0}\NormalTok{), }\AttributeTok{breaks =}\FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{5000}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1000}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_colour\_brewer}\NormalTok{(}\AttributeTok{name =} \StringTok{"fluorescence yield"}\NormalTok{, }\AttributeTok{palette =} \StringTok{"Set1"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"right"}\NormalTok{,}
        \AttributeTok{legend.key.height =} \FunctionTok{unit}\NormalTok{(}\FloatTok{1.2}\NormalTok{, }\StringTok{"cm"}\NormalTok{), }
        \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{(),}
        \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{12}\NormalTok{, }\AttributeTok{colour =} \DecValTok{1}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{, }\AttributeTok{y =} \StringTok{""}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Soclim stations"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{coord\_quickmap}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-19.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# pigment analysis {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}

\NormalTok{soclim\_pig }\OtherTok{\textless{}{-}}\NormalTok{ soclim\_dist\_clean }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(station, }\StringTok{\textquotesingle{}lat\textquotesingle{}} \OtherTok{=}\NormalTok{ latitude\_deg\_north,}
                                       \StringTok{\textquotesingle{}lon\textquotesingle{}} \OtherTok{=}\NormalTok{ longitude\_deg\_east,}
                                      \StringTok{\textquotesingle{}depth\textquotesingle{}} \OtherTok{=}\NormalTok{ depth\_m,}
\NormalTok{                                      cast\_id,}
                                      \StringTok{\textquotesingle{}fuco\textquotesingle{}} \OtherTok{=}\NormalTok{ fucoxanthin,}
                                      \StringTok{\textquotesingle{}zea\textquotesingle{}} \OtherTok{=}\NormalTok{ zeaxanthin,}
                                      \StringTok{\textquotesingle{}allo\textquotesingle{}} \OtherTok{=}\NormalTok{ alloxanthin,}
                                      \StringTok{\textquotesingle{}peri\textquotesingle{}} \OtherTok{=}\NormalTok{ peridinin,}
                                      \StringTok{\textquotesingle{}but\textquotesingle{}} \OtherTok{=}\NormalTok{ x19\_butanoyloxyfucoxanthin,}
                                      \StringTok{\textquotesingle{}hex\textquotesingle{}} \OtherTok{=}\NormalTok{ x19\_hexanoyloxyfucoxanthin,}
                                      \StringTok{\textquotesingle{}tchlb\textquotesingle{}} \OtherTok{=}\NormalTok{ t\_chlb,}
                                      \StringTok{\textquotesingle{}tchla\textquotesingle{}} \OtherTok{=}\NormalTok{ total\_chlorophyll\_a)}

\NormalTok{soclim\_pig[soclim\_pig }\SpecialCharTok{==} \StringTok{"LOD"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"0"}
  
\NormalTok{soclim\_pig }\OtherTok{\textless{}{-}}\NormalTok{ soclim\_pig }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{na.omit}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{fuco =} \FunctionTok{as.numeric}\NormalTok{(fuco),}
         \AttributeTok{zea =} \FunctionTok{as.numeric}\NormalTok{(zea),}
         \AttributeTok{allo =} \FunctionTok{as.numeric}\NormalTok{(allo),}
         \AttributeTok{peri =} \FunctionTok{as.numeric}\NormalTok{(peri),}
         \AttributeTok{but =} \FunctionTok{as.numeric}\NormalTok{(but),}
         \AttributeTok{hex =} \FunctionTok{as.numeric}\NormalTok{(hex),}
         \AttributeTok{tchlb =} \FunctionTok{as.numeric}\NormalTok{(tchlb),}
         \AttributeTok{wdp =} \FloatTok{1.56} \SpecialCharTok{*}\NormalTok{ fuco }\SpecialCharTok{+} \FloatTok{0.92} \SpecialCharTok{*}\NormalTok{ peri }\SpecialCharTok{+} \FloatTok{4.8} \SpecialCharTok{*}\NormalTok{ allo }\SpecialCharTok{+} \FloatTok{1.02} \SpecialCharTok{*}\NormalTok{ but }\SpecialCharTok{+} \FloatTok{1.12} \SpecialCharTok{*}\NormalTok{ hex }\SpecialCharTok{+} \FloatTok{1.51} \SpecialCharTok{*}\NormalTok{ zea }\SpecialCharTok{+} \FloatTok{0.69} \SpecialCharTok{*}\NormalTok{ tchlb,}
         \AttributeTok{micro =}\NormalTok{ (}\FloatTok{1.56} \SpecialCharTok{*}\NormalTok{ fuco }\SpecialCharTok{+} \FloatTok{0.92} \SpecialCharTok{*}\NormalTok{ peri)}\SpecialCharTok{/}\NormalTok{wdp,}
         \AttributeTok{nano =}\NormalTok{ (}\FloatTok{4.8} \SpecialCharTok{*}\NormalTok{ allo }\SpecialCharTok{+} \FloatTok{1.02} \SpecialCharTok{*}\NormalTok{ but }\SpecialCharTok{+} \FloatTok{1.51} \SpecialCharTok{*}\NormalTok{ hex)}\SpecialCharTok{/}\NormalTok{wdp,}
         \AttributeTok{pico =}\NormalTok{ (}\FloatTok{1.51} \SpecialCharTok{*}\NormalTok{ zea }\SpecialCharTok{+} \FloatTok{0.69} \SpecialCharTok{*}\NormalTok{ tchlb)}\SpecialCharTok{/}\NormalTok{wdp)}

\CommentTok{\#♠perform CA}
\NormalTok{AFC }\OtherTok{\textless{}{-}} \FunctionTok{cca}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(soclim\_pig, fuco}\SpecialCharTok{:}\NormalTok{tchlb), }\AttributeTok{scale =} \ConstantTok{TRUE}\NormalTok{)}

\CommentTok{\#extract scores of eache point}
\NormalTok{scores }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{scores}\NormalTok{(AFC, }\AttributeTok{choices =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{), }\AttributeTok{display =} \StringTok{"site"}\NormalTok{))}
\NormalTok{soclim\_pig }\OtherTok{\textless{}{-}} \FunctionTok{bind\_cols}\NormalTok{(soclim\_pig, scores) }\CommentTok{\#addthem to lov df}

\CommentTok{\#compute score of environmental variables a.k.a pigments}
\NormalTok{fitscore }\OtherTok{\textless{}{-}} \FunctionTok{envfit}\NormalTok{(AFC, dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(soclim\_pig, fuco}\SpecialCharTok{:}\NormalTok{tchlb), }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)  }
\NormalTok{fitarrow }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(fitscore}\SpecialCharTok{$}\NormalTok{vectors}\SpecialCharTok{$}\NormalTok{arrows)}

\CommentTok{\#plot the all}
\FunctionTok{ggplot}\NormalTok{(soclim\_pig)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ CA1, }\AttributeTok{y =}\NormalTok{ CA2, }\AttributeTok{colour =}\NormalTok{ ))}\SpecialCharTok{+}
  \FunctionTok{geom\_segment}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{y =} \DecValTok{0}\NormalTok{, }\AttributeTok{xend =}\NormalTok{ CA1}\SpecialCharTok{*}\FloatTok{1.7}\NormalTok{, }\AttributeTok{yend =}\NormalTok{ CA2}\SpecialCharTok{*}\FloatTok{1.7}\NormalTok{), }\AttributeTok{data =}\NormalTok{ fitarrow)}\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ CA1}\SpecialCharTok{*}\FloatTok{1.7}\NormalTok{, }\AttributeTok{y =}\NormalTok{ CA2}\SpecialCharTok{*}\FloatTok{1.7}\NormalTok{, }\AttributeTok{label=}\FunctionTok{rownames}\NormalTok{(fitarrow), }\AttributeTok{fontface =} \DecValTok{2}\NormalTok{), }\AttributeTok{data =}\NormalTok{ fitarrow)}\SpecialCharTok{+}
  \FunctionTok{scale\_color\_viridis\_c}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-20.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#create tree cluster}
\NormalTok{distsoclim}\OtherTok{\textless{}{-}} \FunctionTok{dist}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(soclim\_pig, CA1, CA2))}
\FunctionTok{plot}\NormalTok{(}\FunctionTok{hclust}\NormalTok{(distsoclim))}
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-21.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soclim\_pig}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(}\FunctionTok{cutree}\NormalTok{(}\FunctionTok{hclust}\NormalTok{(distsoclim, }\AttributeTok{method =} \StringTok{"ward.D"}\NormalTok{), }\AttributeTok{k =} \DecValTok{3}\NormalTok{))}

\FunctionTok{ggplot}\NormalTok{(soclim\_pig)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ lat, }\AttributeTok{y =} \SpecialCharTok{{-}}\NormalTok{depth, }\AttributeTok{colour =}\NormalTok{ group))}
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-22.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_tile}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ lon, }\AttributeTok{y =}\NormalTok{ lat, }\AttributeTok{fill =}\NormalTok{ height), }\AttributeTok{data =}\NormalTok{ bath\_df)}\SpecialCharTok{+}
  \FunctionTok{geom\_polygon}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ long, }\AttributeTok{y =}\NormalTok{ lat), }\AttributeTok{data =}\NormalTok{ worldmap, }\AttributeTok{fill =} \StringTok{"Grey"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ lon, }\AttributeTok{y =}\NormalTok{ lat, }\AttributeTok{colour =}\NormalTok{ group), }\AttributeTok{data =}\NormalTok{soclim\_pig)}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_gradientn}\NormalTok{(}\AttributeTok{name =} \StringTok{"Bathymetri"}\NormalTok{,}\AttributeTok{colours =} \FunctionTok{oceColorsGebco}\NormalTok{(),}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{6000}\NormalTok{,}\DecValTok{0}\NormalTok{), }\AttributeTok{breaks =}\FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{5000}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1000}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_colour\_brewer}\NormalTok{(}\AttributeTok{name =} \StringTok{"fluorescence yield"}\NormalTok{, }\AttributeTok{palette =} \StringTok{"Set1"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"right"}\NormalTok{,}
        \AttributeTok{legend.key.height =} \FunctionTok{unit}\NormalTok{(}\FloatTok{1.2}\NormalTok{, }\StringTok{"cm"}\NormalTok{), }
        \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{(),}
        \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{12}\NormalTok{, }\AttributeTok{colour =} \DecValTok{1}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{, }\AttributeTok{y =} \StringTok{""}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Soclim stations"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{coord\_quickmap}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-23.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# treemap of pigments {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}

\NormalTok{soclim\_pop }\OtherTok{\textless{}{-}}\NormalTok{ soclim\_pig }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(fuco}\SpecialCharTok{:}\NormalTok{tchlb, group) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(group) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise\_all}\NormalTok{(mean) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_longer}\NormalTok{(fuco}\SpecialCharTok{:}\NormalTok{tchlb, }\AttributeTok{names\_to =} \StringTok{"pigment"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"concentration"}\NormalTok{)}

\NormalTok{pig\_index }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\StringTok{"pigment"} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"fuco"}\NormalTok{, }\StringTok{"zea"}\NormalTok{, }\StringTok{"allo"}\NormalTok{, }\StringTok{"peri"}\NormalTok{, }\StringTok{"but"}\NormalTok{, }\StringTok{"hex"}\NormalTok{, }\StringTok{"tchlb"}\NormalTok{),}
                        \StringTok{"size\_class"} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"micro"}\NormalTok{, }\StringTok{"pico"}\NormalTok{, }\StringTok{"nano"}\NormalTok{, }\StringTok{"micro"}\NormalTok{, }\StringTok{"nano"}\NormalTok{, }\StringTok{"nano"}\NormalTok{, }\StringTok{"pico"}\NormalTok{))}

\NormalTok{soclim\_pop }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(soclim\_pop, pig\_index)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Joining, by = "pigment"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(treemap)}

\FunctionTok{treemap}\NormalTok{(}\FunctionTok{filter}\NormalTok{(soclim\_pop, group }\SpecialCharTok{==} \StringTok{"1"}\NormalTok{), }\AttributeTok{index=}\FunctionTok{c}\NormalTok{(}\StringTok{"size\_class"}\NormalTok{,}\StringTok{"pigment"}\NormalTok{), }\AttributeTok{vSize=}\StringTok{"concentration"}\NormalTok{,}
        
        \AttributeTok{type=}\StringTok{"index"}\NormalTok{,                            }\CommentTok{\# How you color the treemap. type help(treemap) for more info}
        \AttributeTok{palette =} \StringTok{"Set1"}\NormalTok{,                        }\CommentTok{\# Select your color palette from the RColorBrewer presets or make your own.}
        \AttributeTok{title=}\StringTok{"Group 1"}\NormalTok{,                      }\CommentTok{\# Customize your title}
        \AttributeTok{fontsize.title=}\DecValTok{12}\NormalTok{,                       }\CommentTok{\# Size of the title}
        
\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-24.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{treemap}\NormalTok{(}\FunctionTok{filter}\NormalTok{(soclim\_pop, group }\SpecialCharTok{==} \StringTok{"2"}\NormalTok{), }\AttributeTok{index=}\FunctionTok{c}\NormalTok{(}\StringTok{"size\_class"}\NormalTok{,}\StringTok{"pigment"}\NormalTok{), }\AttributeTok{vSize=}\StringTok{"concentration"}\NormalTok{,}
        
        \AttributeTok{type=}\StringTok{"index"}\NormalTok{,                            }\CommentTok{\# How you color the treemap. type help(treemap) for more info}
        \AttributeTok{palette =} \StringTok{"Set1"}\NormalTok{,                        }\CommentTok{\# Select your color palette from the RColorBrewer presets or make your own.}
        \AttributeTok{title=}\StringTok{"Group 2"}\NormalTok{,                      }\CommentTok{\# Customize your title}
        \AttributeTok{fontsize.title=}\DecValTok{12}\NormalTok{,                       }\CommentTok{\# Size of the title}
        
\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-25.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{treemap}\NormalTok{(}\FunctionTok{filter}\NormalTok{(soclim\_pop, group }\SpecialCharTok{==} \StringTok{"3"}\NormalTok{), }\AttributeTok{index=}\FunctionTok{c}\NormalTok{(}\StringTok{"size\_class"}\NormalTok{,}\StringTok{"pigment"}\NormalTok{), }\AttributeTok{vSize=}\StringTok{"concentration"}\NormalTok{,}
        
        \AttributeTok{type=}\StringTok{"index"}\NormalTok{,                            }\CommentTok{\# How you color the treemap. type help(treemap) for more info}
        \AttributeTok{palette =} \StringTok{"Set1"}\NormalTok{,                        }\CommentTok{\# Select your color palette from the RColorBrewer presets or make your own.}
        \AttributeTok{title=}\StringTok{"Group 3"}\NormalTok{,                      }\CommentTok{\# Customize your title}
        \AttributeTok{fontsize.title=}\DecValTok{12}\NormalTok{,                       }\CommentTok{\# Size of the title}
        
\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{soclim_files/figure-latex/unnamed-chunk-1-26.pdf}

\end{document}
